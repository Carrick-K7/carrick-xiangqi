<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Pikafish Engine Test</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .log { background: #f0f0f0; padding: 10px; margin: 5px 0; border-radius: 4px; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>Pikafish 引擎测试</h1>
    <div id="logs"></div>

    <script src="engine/pikafish.js"></script>
    <script src="engine/engine.js"></script>
    <script>
        const logs = document.getElementById('logs');
        
        function log(msg, isError = false) {
            const div = document.createElement('div');
            div.className = 'log ' + (isError ? 'error' : '');
            div.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            logs.appendChild(div);
        }

        async function testEngine() {
            log('开始测试...');
            
            try {
                // 检查 Pikafish 是否加载
                if (typeof Pikafish === 'undefined') {
                    throw new Error('Pikafish 未加载');
                }
                log('✓ Pikafish 脚本已加载');
                
                // 检查 XiangqiEngine 类是否存在
                if (typeof XiangqiEngine === 'undefined') {
                    throw new Error('XiangqiEngine 类未定义');
                }
                log('✓ XiangqiEngine 类已定义');
                
                // 创建引擎实例
                const engine = new XiangqiEngine();
                log('✓ 引擎实例已创建');
                
                // 尝试初始化
                log('正在初始化引擎...');
                await engine.init();
                log('✓ 引擎初始化成功', false);
                
                // 测试设置局面
                const startFEN = 'rnbakabnr/9/1c5c1/p1p1p1p1p/9/9/P1P1P1P1P/1C5C1/9/RNBAKABNR w';
                await engine.position(startFEN);
                log('✓ 局面设置成功');
                
                // 测试分析
                log('正在分析局面（约2秒）...');
                const result = await engine.go({ movetime: 2000 });
                log(`✓ 分析完成: 最佳着法 = ${result.bestMove}, 评估 = ${result.evaluation}`);
                
                // 计算胜率
                const winrate = XiangqiEngine.scoreToWinrate(result.evaluation || 0);
                log(`胜率计算: 红方 ${winrate}%`);
                
                log('所有测试通过！', false);
                
            } catch (error) {
                log('✗ 错误: ' + error.message, true);
                console.error(error);
            }
        }

        // 页面加载后自动测试
        window.onload = testEngine;
    </script>
</body>
</html>
