<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è±¡æ£‹å¼•æ“æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .log {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>ğŸ¯ è±¡æ£‹å¼•æ“è¯Šæ–­æµ‹è¯•</h1>
    
    <div id="status">
        <p>çŠ¶æ€: <span id="statusText">ç­‰å¾…æµ‹è¯•...</span></p>
    </div>
    
    <div>
        <button onclick="testEngine()">æµ‹è¯•å¼•æ“åŠ è½½</button>
        <button onclick="clearLog()">æ¸…é™¤æ—¥å¿—</button>
    </div>
    
    <div class="log" id="log">æ—¥å¿—å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</div>

    <script src="engine/pikafish.js"></script>
    <script src="engine/engine.js"></script>
    
    <script>
        const logEl = document.getElementById('log');
        const statusEl = document.getElementById('statusText');
        
        function log(msg, type = 'info') {
            const time = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
            logEl.innerHTML += `[${time}] <span class="${className}">${msg}</span>\n`;
            logEl.scrollTop = logEl.scrollHeight;
        }
        
        function clearLog() {
            logEl.innerHTML = '';
        }
        
        // æ•è·æ‰€æœ‰æ§åˆ¶å°è¾“å‡º
        const originalLog = console.log;
        const originalError = console.error;
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            log(args.join(' '), 'info');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            log(args.join(' '), 'error');
        };
        
        async function testEngine() {
            clearLog();
            statusEl.textContent = 'æµ‹è¯•ä¸­...';
            
            try {
                // 1. æ£€æŸ¥ Pikafish æ˜¯å¦åŠ è½½
                log('1. æ£€æŸ¥ Pikafish è„šæœ¬...');
                if (typeof Pikafish === 'undefined') {
                    throw new Error('Pikafish æœªå®šä¹‰ - è„šæœ¬å¯èƒ½æœªåŠ è½½');
                }
                log('âœ“ Pikafish è„šæœ¬å·²åŠ è½½', 'success');
                
                // 2. æ£€æŸ¥ XiangqiEngine æ˜¯å¦åŠ è½½
                log('2. æ£€æŸ¥ XiangqiEngine ç±»...');
                if (typeof XiangqiEngine === 'undefined') {
                    throw new Error('XiangqiEngine æœªå®šä¹‰ - engine.js å¯èƒ½æœªåŠ è½½');
                }
                log('âœ“ XiangqiEngine ç±»å·²åŠ è½½', 'success');
                
                // 3. åˆ›å»ºå¼•æ“å®ä¾‹
                log('3. åˆ›å»ºå¼•æ“å®ä¾‹...');
                const engine = new XiangqiEngine();
                log('âœ“ å¼•æ“å®ä¾‹åˆ›å»ºæˆåŠŸ', 'success');
                
                // 4. åˆå§‹åŒ–å¼•æ“
                log('4. åˆå§‹åŒ–å¼•æ“ï¼ˆè¿™å¯èƒ½éœ€è¦å‡ ç§’é’Ÿï¼‰...');
                await engine.init();
                
                if (engine.isReady) {
                    log('âœ“ å¼•æ“åˆå§‹åŒ–æˆåŠŸï¼', 'success');
                    statusEl.textContent = 'å¼•æ“å¯ç”¨';
                    statusEl.style.color = 'green';
                    
                    // 5. æµ‹è¯•åˆ†æ
                    log('5. æµ‹è¯•å±€é¢åˆ†æ...');
                    const result = await engine.getBestMove('rnbakabnr/9/1c5c1/p1p1p1p1p/9/9/P1P1P1P1P/1C5C1/9/RNBAKABNR w - - 0 1', 5);
                    log(`åˆ†æç»“æœ: ${JSON.stringify(result, null, 2)}`, 'success');
                } else {
                    throw new Error('å¼•æ“åˆå§‹åŒ–å®Œæˆä½†æœªå°±ç»ª');
                }
                
            } catch (error) {
                log(`âœ— é”™è¯¯: ${error.message}`, 'error');
                console.error(error);
                statusEl.textContent = 'æµ‹è¯•å¤±è´¥';
                statusEl.style.color = 'red';
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•
        window.onload = function() {
            log('é¡µé¢å·²åŠ è½½ï¼Œç‚¹å‡»"æµ‹è¯•å¼•æ“åŠ è½½"å¼€å§‹æµ‹è¯•');
        };
    </script>
</body>
</html>
