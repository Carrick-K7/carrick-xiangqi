# E2E测试最佳实践

## 目录

1. [测试先行原则](#测试先行原则)
2. [E2E作为完成标准](#e2e作为完成标准)
3. [数据真实性验证](#数据真实性验证)
4. [测试用例设计](#测试用例设计)
5. [CI/CD集成](#cicd集成)

## 测试先行原则

### 核心理念
**没有测试的功能等于未完成的功能**

### 实践方法
1. 在编写功能代码前，先编写失败的测试
2. 运行测试确认失败（红）
3. 编写最少代码使测试通过（绿）
4. 重构优化代码（重构）

## E2E作为完成标准

### 定义完成的条件

| 检查项 | 要求 | 验证方式 |
|--------|------|----------|
| 功能实现 | 需求完全覆盖 | 代码审查 |
| 单元测试 | 覆盖率≥80% | 自动化报告 |
| E2E测试 | 核心场景覆盖 | 测试套件 |
| 文档更新 | 同步更新 | 文档审查 |

### 流程图

```
开发任务 → 编写E2E测试 → 实现功能 → 运行测试 → 测试通过 → 任务完成
                ↑___________________________↓
                        失败则修复
```

## 数据真实性验证

### 为什么需要真实数据

- 模拟数据可能无法发现真实环境问题
- 边界条件在真实数据中更常见
- 用户体验更接近生产环境

### 数据策略

1. **测试数据库**
   - 使用与生产相同结构的数据库
   - 定期同步生产数据脱敏副本

2. **数据工厂**
   - 创建可复用的数据生成器
   - 支持多种数据场景

3. **数据隔离**
   - 每个测试独立数据
   - 测试结束后清理数据

## 测试用例设计

### 用户场景覆盖

#### 核心路径测试
- 用户注册 → 登录 → 核心功能 → 退出
- 完整业务流程端到端验证

#### 异常路径测试
- 网络中断恢复
- 无效输入处理
- 权限不足场景

#### 边界条件测试
- 空数据提交
- 超长内容输入
- 并发操作冲突

### 测试代码规范

```typescript
// 好的测试：描述性行为
test('用户应该能够使用有效凭证登录', async () => {
  await page.goto('/login')
  await page.fill('[data-testid=email]', 'user@example.com')
  await page.fill('[data-testid=password]', 'validPassword')
  await page.click('[data-testid=submit]')
  await expect(page).toHaveURL('/dashboard')
})
```

## CI/CD集成

### 流水线配置

```yaml
e2e-tests:
  stage: test
  script:
    - npm run test:e2e
  artifacts:
    reports:
      junit: e2e-results.xml
    when: always
```

### 失败处理

1. **测试失败** → 阻塞合并
2. ** flaky 测试** → 标记待修复
3. **环境问题** → 重试机制

---
*最后更新：2026-02-10*
