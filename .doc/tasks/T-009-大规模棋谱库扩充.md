# T-009: 大规模棋谱库扩充与验证

## 任务目标
扩充象棋棋谱库至350-400局，涵盖现代名局、布局谱、残局谱，并全部验证可完整推演。

## 需求规格

### 1. 棋谱分类与数量

| 类型 | 当前 | 目标 | 新增 |
|:---|:---:|:---:|:---:|
| **现代名局** | 30局 | 100局 | +70局 |
| **布局谱** | 0局 | 80局 | +80局 |
| **残局谱** | 50局 | 100局 | +50局 |
| **古代棋谱** | 157局 | 157局 | 不变 |
| **总计** | **237局** | **437局** | **+200局** |

### 2. 现代名局（新增70局）

**数据来源优先级：**
1. **CCBridge数据库** - 数十万局PGN格式
2. **东萍象棋网** - 中国最大棋谱库
3. **象棋巫师** - 专业棋谱软件数据

**选择标准：**
- 2010年后的对局（较新）
- 全国象棋个人赛、甲级联赛
- 象棋世锦赛、亚洲赛
- 网络知名对局

**大师分布：**
- 王天一：新增20局（总计30局）
- 郑惟桐：新增15局
- 许银川：新增10局（总计20局）
- 胡荣华：新增5局（总计15局）
- 其他大师：新增20局

### 3. 布局谱（新增80局）

**现代流行开局：**

| 开局类型 | 数量 | 说明 |
|:---|:---:|:---|
| **中炮对屏风马** | 20局 | 最常见开局 |
| **中炮对反宫马** | 15局 | 稳健开局 |
| **仙人指路** | 15局 | 灵活开局 |
| **飞相局** | 15局 | 稳健防守 |
| **过宫炮** | 10局 | 冷门但有效 |
| **其他** | 5局 | 冷门开局 |

### 4. 残局谱（新增50局）

**来源：**
- 适情雅趣（补充完整550局中的剩余）
- 烂柯神机残局部分
- 现代实用残局

**类型分布：**
- 车马冷着：10局
- 炮兵残局：10局
- 车兵残局：10局
- 马兵残局：10局
- 复杂残局：10局

## 技术实现

### 数据格式标准
```json
{
  "id": "modern-XXX",
  "name": "对局名称",
  "collection": "现代名局",
  "era": "2024",
  "type": "modern",
  "category": "全国个人赛",
  "players": {
    "red": "红方姓名",
    "black": "黑方姓名"
  },
  "opening": "开局名称",
  "moves": ["炮二平五", "馬8进7", ...],
  "pgn": "1. 炮二平五 馬8进7 ...",
  "result": "红胜|黑胜|和棋",
  "difficulty": "简单|中等|较难|困难",
  "significance": "重要性说明"
}
```

### 验证流程（关键！）

**所有棋谱必须验证可走完：**

```javascript
for (const game of games) {
  const board = initBoard();
  let valid = true;
  
  for (let i = 0; i < game.moves.length; i++) {
    const result = executeMove(board, game.moves[i], i);
    if (!result.success) {
      console.error(`${game.name} 第${i+1}步失败: ${game.moves[i]}`);
      valid = false;
      break;
    }
  }
  
  if (valid) {
    console.log(`✅ ${game.name} 验证通过`);
  }
}
```

### 文件结构
```
xiangqi_data/
├── ancient/           # 古代棋谱（已有157局）
├── modern/            # 现代名局（目标100局）
│   ├── wang_tianyi.json
│   ├── zheng_weitong.json
│   ├── xu_yinchuan.json
│   ├── hu_ronghua.json
│   └── other_masters.json
├── openings/          # 布局谱（目标80局）
│   ├── zhongpao_pingfengma.json
│   ├── xianrenzhilu.json
│   └── ...
└── endgames/          # 残局谱（目标100局）
    ├── shiqing_yaqu_complete.json
    └── modern_endgames.json
```

## 开发步骤

1. [ ] 收集70局现代名局（王天一/郑惟桐等）
2. [ ] 收集80局布局谱
3. [ ] 收集50局残局谱
4. [ ] 开发棋谱验证脚本
5. [ ] 全部200局棋谱逐一验证
6. [ ] 修复验证失败的棋谱
7. [ ] 更新game-data.js加载逻辑
8. [ ] 部署并测试

## 完成标准

- [ ] 棋谱总数达到437局
- [ ] 所有棋谱100%可完整推演
- [ ] Playwright验证棋谱加载和播放
- [ ] Dashboard展示更新

## 预估时间

- 数据收集：2-3小时
- 验证修复：2-3小时
- 总计：4-6小时

---
**关联**: T-008（棋谱推演功能）
**优先级**: P1（高）
